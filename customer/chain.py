# -*- coding: windows-1251 -*-

import os
from langchain.prompts import PromptTemplate
from langchain_openai import ChatOpenAI
from langchain.schema.output_parser import StrOutputParser
from dotenv import load_dotenv

# Загрузка переменных окружения
load_dotenv()
openai_api_key = os.getenv("OPENAI_API_KEY")
if not openai_api_key:
    raise ValueError("API ключ OpenAI не найден в переменных окружения")


# Цепочка для стоимости товара

cost_chain = (
        PromptTemplate.from_template(
            """Вы опытный менеджер по продажам. Сформулируйте ответ на вопрос клиента о стоимости товара, используя данные о товаре.

            Убедитесь, что:
            - Ответ включает точную стоимость товара.
            - Упоминается количество товара, доступного в наличии.
            - В конце задаётся вопрос: "Сколько единиц товара Вам требуется?" или аналогичный уточняющий вопрос.

            Вопрос клиента: {question}

            Данные о товаре:
            {product_info}

            Ответ:"""
        )
        | ChatOpenAI(api_key=openai_api_key)
)

# 3. Цепочка для наличия товара на складе
stock_chain = (
        PromptTemplate.from_template(
            """Вы опытный менеджер по продажам. Сформулируйте ответ на вопрос клиента о наличии товара на складе, используя данные о товаре.

            Убедитесь, что:
            - Ответ кратко и точно информирует о наличии товара.
            - Упоминается количество единиц, доступных для заказа.
            - В конце задаётся уточняющий вопрос, например: "Сколько единиц товара Вам требуется?" или аналогичный.

            Вопрос клиента: {question}

            Данные о товаре:
            {product_info}

            Ответ:"""
        )
        | ChatOpenAI()
)

# 4. Цепочка для общих вопросов
general_chain = (
        PromptTemplate.from_template(
            """Вы опытный менеджер по продажам. Ответьте на следующий вопрос клиента максимально профессионально, дружелюбно и по существу.
    
            Убедитесь, что:
            - Ответ полностью соответствует контексту вопроса.
            - Если требуется дополнительная информация, предложите клиенту уточнить детали.
    
            Вопрос клиента: {question}
    
            Ответ:"""
        )
        | ChatOpenAI()
)